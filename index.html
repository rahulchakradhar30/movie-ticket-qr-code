<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Movie Ticket — Dark Ticket Generator</title>

<!-- QRious CDN (stable and GitHub Pages friendly) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js" integrity="sha512-+bVbQn3zqXhQ5nY7mH3y8n2k8t8Qm0t7sX7qYF2gZqG3yZJgH3X9Yl5b1w5r7e6T8Y9yQk2hK4q2z9wQfQzQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<style>
  :root{
    --bg:#05060a;
    --panel:#0c1116;
    --muted:#9aa3ad;
    --accent:#ff6b6b;
    --white:#fff;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background: radial-gradient(1000px 600px at 10% 10%, #081220 0%, transparent 20%),
                radial-gradient(800px 500px at 90% 90%, #08121a 0%, transparent 20%),
                linear-gradient(180deg,#000,#071428 60%);
    font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    color:var(--white);
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:28px;
  }

  .layout{
    width:100%;
    max-width:1100px;
    display:grid;
    grid-template-columns:1fr 460px;
    gap:26px;
  }

  .panel{
    background: linear-gradient(180deg,#07101a,#07111b);
    border-radius:12px;
    padding:18px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.6);
  }

  h2{ margin:0 0 6px; font-size:20px; color:#e9eef6; }
  p.hint{ color:var(--muted); margin:6px 0 12px; font-size:13px; }

  label{ display:block; font-size:13px; color:var(--muted); margin-top:12px; margin-bottom:6px; }
  input[type="text"], input[type="date"], input[type="time"], input[type="file"]{
    width:100%;
    padding:10px 12px;
    border-radius:8px;
    border:1px solid rgba(255,255,255,0.04);
    background:rgba(255,255,255,0.02);
    color:var(--white);
    font-size:14px;
  }

  .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
  .actions{ display:flex; gap:12px; margin-top:14px; }
  .btn{
    padding:12px 14px; border-radius:10px; border:none; font-weight:700; cursor:pointer; font-size:14px;
  }
  .btn.primary{ background: linear-gradient(90deg,var(--accent),#ee5a24); color: #fff; flex:1; }
  .btn.ghost{ background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--white); width:110px; }

  /* preview ticket */
  .preview-wrap{ display:flex; align-items:center; justify-content:center; }
  .ticket{
    width:420px; background:linear-gradient(180deg,#0a0a0b,#0b0b0d); border-radius:12px; padding:18px; box-shadow:0 18px 40px rgba(0,0,0,0.6);
    color:#fff; position:relative; overflow:hidden; font-size:14px;
  }
  .ticket .top{ display:flex; gap:12px; align-items:center; }
  .poster{
    width:64px; height:92px; border-radius:6px; background:linear-gradient(180deg,#222,#111);
    overflow:hidden; flex:0 0 64px; display:flex; align-items:center; justify-content:center;
  }
  .poster img{ width:100%; height:100%; object-fit:cover; display:block; }

  .title{ font-weight:800; font-size:16px; color:#fff; }
  .meta{ color:var(--muted); font-size:12px; margin-top:4px; }

  .big-qr{ width:160px; height:160px; background:#fff; border-radius:12px; display:flex; align-items:center; justify-content:center; margin:16px auto 8px auto; }

  .ticket .info{ text-align:center; margin-top:6px; }
  .ticket .info .line{ font-size:12px; color:var(--muted); margin-top:6px; letter-spacing:1px; }
  .ticket .info .value{ font-weight:800; font-size:14px; margin-top:6px; }

  .download{ display:block; margin-top:12px; background:linear-gradient(90deg,#2db04b,#178f2f); text-decoration:none; color:#fff; padding:10px; border-radius:8px; text-align:center; font-weight:800; }

  .small{ font-size:12px; color:var(--muted); margin-top:8px; }

  @media (max-width:950px){
    .layout{ grid-template-columns:1fr; }
    .preview-wrap{ margin-top:18px; justify-content:center; }
  }
</style>
</head>
<body>

<div class="layout">
  <!-- Left: form -->
  <div class="panel">
    <h2>Movie Ticket — Dark Generator</h2>
    <p class="hint">Upload poster (optional), fill details and generate a District-style ticket with QR.</p>

    <label>Movie Poster (optional)</label>
    <input id="posterFile" type="file" accept="image/*">

    <label>Movie Title</label>
    <input id="movieName" type="text" placeholder="Akhandaa 2: Thaandavam">

    <div class="grid2">
      <div>
        <label>Movie Date</label>
        <input id="movieDate" type="date">
      </div>
      <div>
        <label>Movie Time</label>
        <input id="movieTime" type="time">
      </div>
    </div>

    <div class="grid2">
      <div>
        <label>Theatre</label>
        <input id="theatre" type="text" placeholder="V Mega Anand Cine Complex">
      </div>
      <div>
        <label>Screen</label>
        <input id="screen" type="text" placeholder="Screen-1">
      </div>
    </div>

    <label>Seats (comma separated)</label>
    <input id="seats" type="text" placeholder="GOLD-B9">

    <div class="grid2" style="margin-top:12px;">
      <div>
        <label>Language / Format</label>
        <input id="lang" type="text" placeholder="Telugu | 2D">
      </div>
      <div>
        <label>Booking ID (optional)</label>
        <input id="booking" type="text" placeholder="Leave empty to auto-generate">
      </div>
    </div>

    <div class="actions">
      <button class="btn primary" onclick="generateTicket()">Generate QR Code</button>
      <button class="btn ghost" onclick="resetAll()">Reset</button>
    </div>

    <p class="small">After generate, click "Download Ticket" on the right to save a full PNG of the ticket.</p>
  </div>

  <!-- Right: preview -->
  <div class="preview-wrap">
    <div class="ticket" id="ticketPreview" role="presentation">
      <div class="top">
        <div class="poster" id="posterPreview">
          <img id="posterImg" src="" alt="poster" style="display:none">
        </div>
        <div style="flex:1">
          <div class="title" id="pvTitle">Movie Title</div>
          <div class="meta" id="pvMeta">Telugu | 2D</div>
        </div>
        <div style="text-align:right">
          <div id="pvDate">Date</div>
          <div class="meta" id="pvTime">Time</div>
        </div>
      </div>

      <div class="big-qr">
        <canvas id="qrCanvas" width="140" height="140" aria-label="QR code"></canvas>
      </div>

      <div class="info">
        <div class="line">SCREEN</div>
        <div class="value" id="pvScreen">-</div>

        <div class="line" style="margin-top:10px">SEAT</div>
        <div class="value" id="pvSeats">-</div>

        <div class="line" style="margin-top:10px">THEATRE</div>
        <div class="value" id="pvTheatre">-</div>

        <div class="line" style="margin-top:12px">Booking ID</div>
        <div class="value" id="pvBooking">-</div>

        <a id="downloadTicketBtn" class="download" href="#" onclick="downloadTicket(event)">Download Ticket</a>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  // Elements
  const posterFile = document.getElementById('posterFile');
  const posterImg = document.getElementById('posterImg');
  const posterPreview = document.getElementById('posterPreview');

  const pvTitle = document.getElementById('pvTitle');
  const pvMeta = document.getElementById('pvMeta');
  const pvDate = document.getElementById('pvDate');
  const pvTime = document.getElementById('pvTime');
  const pvScreen = document.getElementById('pvScreen');
  const pvSeats = document.getElementById('pvSeats');
  const pvTheatre = document.getElementById('pvTheatre');
  const pvBooking = document.getElementById('pvBooking');
  const qrCanvas = document.getElementById('qrCanvas');

  // defaults
  function setDefaults(){
    const now = new Date();
    document.getElementById('movieDate').value = now.toISOString().split('T')[0];
    let hh = String(now.getHours()).padStart(2,'0');
    let mm = now.getMinutes() < 30 ? '00' : '30';
    document.getElementById('movieTime').value = hh + ':' + mm;
    document.getElementById('lang').value = 'Telugu | 2D';
  }
  setDefaults();

  // poster handling
  let posterDataUrl = null;
  posterFile.addEventListener('change', function(ev){
    const f = ev.target.files && ev.target.files[0];
    if(!f){ posterDataUrl = null; posterImg.style.display='none'; posterPreview.style.background = ''; return; }
    const reader = new FileReader();
    reader.onload = function(e){
      posterDataUrl = e.target.result;
      posterImg.src = posterDataUrl;
      posterImg.style.display = 'block';
      posterPreview.style.background = '';
    };
    reader.readAsDataURL(f);
  });

  function genBooking(){
    return 'BK-' + Date.now().toString().slice(-10);
  }

  // generate ticket + QR
  window.generateTicket = function(){
    try{
      const movieName = document.getElementById('movieName').value.trim() || 'Movie Title';
      const movieDate = document.getElementById('movieDate').value;
      const movieTime = document.getElementById('movieTime').value;
      const theatre = document.getElementById('theatre').value.trim() || 'Theatre Name';
      const screen = document.getElementById('screen').value.trim() || 'Screen-1';
      const seats = document.getElementById('seats').value.trim() || 'GOLD-B9';
      const lang = document.getElementById('lang').value.trim() || 'Telugu | 2D';
      const booking = document.getElementById('booking').value.trim() || genBooking();

      // update preview UI
      pvTitle.textContent = movieName;
      pvMeta.textContent = lang;
      try{
        const dObj = new Date(movieDate + 'T' + movieTime);
        pvDate.textContent = dObj.toLocaleDateString(undefined,{weekday:'short', day:'numeric', month:'short'});
        pvTime.textContent = new Date('1970-01-01T' + movieTime).toLocaleTimeString([], {hour:'numeric', minute:'2-digit'});
      }catch(e){
        pvDate.textContent = movieDate || 'Date';
        pvTime.textContent = movieTime || 'Time';
      }
      pvScreen.textContent = screen.toUpperCase();
      pvSeats.textContent = seats.toUpperCase();
      pvTheatre.textContent = theatre;
      pvBooking.textContent = booking;

      // poster preview fallback
      if(posterDataUrl){
        posterImg.src = posterDataUrl;
        posterImg.style.display = 'block';
        posterPreview.style.background = '';
      } else {
        posterImg.style.display = 'none';
        // gray gradient placeholder
        posterPreview.style.background = 'linear-gradient(180deg,#2a2a2a,#111)';
      }

      // QR text to encode
      const qrText = [
        'BookingID:' + booking,
        'Movie:' + movieName,
        'Date:' + pvDate.textContent,
        'Time:' + pvTime.textContent,
        'Theatre:' + theatre,
        'Screen:' + screen,
        'Seats:' + seats
      ].join('\n');

      // clear canvas then draw
      const ctx = qrCanvas.getContext('2d');
      ctx.clearRect(0,0,qrCanvas.width, qrCanvas.height);

      // Use QRious (CDN) to draw on canvas
      new QRious({ element: qrCanvas, value: qrText, size: qrCanvas.width });

      console.log('QR generated');
    } catch(err){
      console.error('Failed to generate QR. See console for details.', err);
      alert('Failed to generate QR. See console for details.');
    }
  };

  // reset
  window.resetAll = function(){
    document.getElementById('movieName').value = '';
    document.getElementById('theatre').value = '';
    document.getElementById('screen').value = '';
    document.getElementById('seats').value = '';
    document.getElementById('booking').value = '';
    posterFile.value = '';
    posterImg.src = '';
    posterImg.style.display = 'none';
    posterPreview.style.background = '';
    setDefaults();
    pvTitle.textContent = 'Movie Title';
    pvMeta.textContent = 'Telugu | 2D';
    pvDate.textContent = 'Date';
    pvTime.textContent = 'Time';
    pvScreen.textContent = '-';
    pvSeats.textContent = '-';
    pvTheatre.textContent = '-';
    pvBooking.textContent = '-';
    const ctx = qrCanvas.getContext('2d');
    ctx.clearRect(0,0,qrCanvas.width, qrCanvas.height);
  };

  // download full ticket as PNG
  window.downloadTicket = function(ev){
    ev && ev.preventDefault && ev.preventDefault();

    // ensure QR drawn
    const ctxCheck = qrCanvas.getContext('2d');
    try {
      const px = ctxCheck.getImageData(0,0,1,1).data;
      const blank = (px[3] === 0);
      if(blank){ alert('Please generate the QR code first.'); return; }
    } catch(e){ /* ignore */ }

    // target image size
    const W = 1000, H = 1600;
    const off = document.createElement('canvas');
    off.width = W; off.height = H;
    const ctx = off.getContext('2d');

    // background
    ctx.fillStyle = '#060609';
    ctx.fillRect(0,0,W,H);

    // inner card
    const pad = 64;
    ctx.fillStyle = '#0f1113';
    roundRect(ctx, pad/2, pad/2, W - pad, H - pad, 28, true, false);

    // poster block
    const posterW = 320, posterH = 460;
    const px = pad + 40, py = pad + 40;
    ctx.fillStyle = '#080808'; roundRect(ctx, px-8, py-8, posterW+16, posterH+16, 12, true, false);

    // draw poster if present
    if(posterDataUrl){
      const img = new Image();
      img.crossOrigin = 'anonymous';
      img.onload = function(){
        // fit/crop center
        const ratio = Math.max(posterW / img.width, posterH / img.height);
        const sw = posterW / ratio, sh = posterH / ratio;
        const sx = (img.width - sw) / 2, sy = (img.height - sh) / 2;
        ctx.drawImage(img, sx, sy, sw, sh, px, py, posterW, posterH);
        drawRightAndSave();
      };
      img.src = posterDataUrl;
    } else {
      // placeholder
      const g = ctx.createLinearGradient(px,py,px+posterW,py+posterH);
      g.addColorStop(0,'#2a2a2a'); g.addColorStop(1,'#111');
      ctx.fillStyle = g; roundRect(ctx, px, py, posterW, posterH, 10, true, false);
      ctx.fillStyle = '#777';
      ctx.font = 'bold 22px Arial'; ctx.fillText('POSTER', px + 20, py + 40);
      drawRightAndSave();
    }

    function drawRightAndSave(){
      const rx = px + posterW + 40;
      const rw = W - rx - pad;

      ctx.fillStyle = '#fff'; ctx.font = 'bold 36px Arial';
      wrapText(ctx, document.getElementById('pvTitle').textContent, rx, py + 10, rw-20, 40);

      ctx.fillStyle = '#bfbfbf'; ctx.font = '18px Arial';
      ctx.fillText(document.getElementById('pvMeta').textContent, rx, py + 120);

      ctx.fillStyle = '#fff'; ctx.font = '28px Arial';
      ctx.fillText(document.getElementById('pvDate').textContent + '  |  ' + document.getElementById('pvTime').textContent, rx, py + 160);

      // theatre
      ctx.fillStyle = '#bfbfbf'; ctx.font = '16px Arial';
      ctx.fillText('THEATRE', rx, py + 220);
      ctx.fillStyle = '#fff'; ctx.font = '20px Arial';
      wrapText(ctx, document.getElementById('pvTheatre').textContent, rx, py + 246, rw-20, 24);

      // seat & screen
      ctx.fillStyle = '#bfbfbf'; ctx.font = '16px Arial';
      ctx.fillText('SCREEN', rx, py + 340);
      ctx.fillStyle = '#fff'; ctx.font = '20px Arial';
      ctx.fillText(document.getElementById('pvScreen').textContent, rx, py + 366);

      ctx.fillStyle = '#bfbfbf'; ctx.font = '16px Arial';
      ctx.fillText('SEAT', rx, py + 406);
      ctx.fillStyle = '#fff'; ctx.font = '20px Arial';
      ctx.fillText(document.getElementById('pvSeats').textContent, rx, py + 432);

      ctx.fillStyle = '#bfbfbf'; ctx.font = '16px Arial';
      ctx.fillText('Booking ID', rx, py + 476);
      ctx.fillStyle = '#fff'; ctx.font = '18px Arial';
      ctx.fillText(document.getElementById('pvBooking').textContent, rx, py + 504);

      // QR from canvas
      const qrImg = new Image();
      qrImg.onload = function(){
        const qsize = 420;
        const qx = W/2 - qsize/2;
        const qy = py + posterH + 40;
        // white rounded box
        ctx.fillStyle = '#fff'; roundRect(ctx, qx, qy, qsize, qsize, 28, true, false);
        const padInside = 36;
        ctx.drawImage(qrImg, qx + padInside, qy + padInside, qsize - 2*padInside, qsize - 2*padInside);

        // footer theatre address (use pvTheatre)
        ctx.fillStyle = '#bfbfbf'; ctx.font = '18px Arial';
        wrapText(ctx, document.getElementById('pvTheatre').textContent, pad + 20, H - 140, W - 2*(pad+20), 22);

        // download
        const data = off.toDataURL('image/png');
        const a = document.createElement('a'); a.href = data; a.download = (document.getElementById('pvTitle').textContent || 'ticket') + '-ticket.png'; a.click();
      };
      qrImg.src = document.getElementById('qrCanvas').toDataURL('image/png');
    }

    // helpers
    function roundRect(ctx,x,y,w,h,r,fill,stroke){
      if(typeof r==='undefined') r=6;
      ctx.beginPath();
      ctx.moveTo(x+r,y);
      ctx.arcTo(x+w,y,x+w,y+h,r);
      ctx.arcTo(x+w,y+h,x,y+h,r);
      ctx.arcTo(x,y+h,x,y,r);
      ctx.arcTo(x,y,x+w,y,r);
      ctx.closePath();
      if(fill) ctx.fill();
      if(stroke) ctx.stroke();
    }
    function wrapText(ctx, text, x, y, maxWidth, lineHeight){
      const words = text.split(' ');
      let line = '';
      for(let n=0;n<words.length;n++){
        const testLine = line + words[n] + ' ';
        const metrics = ctx.measureText(testLine);
        const testWidth = metrics.width;
        if(testWidth > maxWidth && n>0){
          ctx.fillText(line, x, y);
          line = words[n] + ' ';
          y += lineHeight;
        } else {
          line = testLine;
        }
      }
      ctx.fillText(line, x, y);
    }
  };

})();
</script>

</body>
</html>
