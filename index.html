<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Movie Ticket — QR Generator</title>

<style>
  :root{
    --bg1:#1b2735;
    --bg2:#0f3d57;
    --accent:#ff6b6b;
    --ticket:#fff7f2;
    --muted:#666;
  }
  body{
    margin:0;
    font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
    background: linear-gradient(135deg,var(--bg1),var(--bg2));
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:24px;
    color:#111;
  }

  .wrapper{
    width:100%;
    max-width:980px;
    display:grid;
    grid-template-columns: 1fr 420px;
    gap:24px;
    align-items:start;
  }

  /* Left: Form */
  .card{
    background: linear-gradient(180deg,#ffffffee,#fff8f4);
    border-radius:16px;
    padding:22px;
    box-shadow: 0 18px 40px rgba(2,6,23,0.45);
  }

  h1{
    margin:0 0 8px 0;
    font-size:22px;
    color:#222;
  }
  p.lead{ margin:0 0 18px 0; color:var(--muted); }

  .form-grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:12px;
    margin-top:8px;
  }

  label{ display:block; font-size:13px; color:#444; margin-bottom:6px; font-weight:600;}
  input, select{ width:100%; padding:10px 12px; border-radius:10px; border:1px solid #e6e6e6; font-size:14px; }
  input:focus, select:focus{ outline:none; box-shadow:0 6px 18px rgba(0,0,0,0.06); border-color:var(--accent); }

  .full { grid-column: 1 / -1; }
  .actions{ display:flex; gap:12px; margin-top:16px; }
  .btn{
    flex:1;
    padding:12px 16px;
    border-radius:12px;
    border:none;
    font-weight:700;
    cursor:pointer;
    font-size:15px;
  }
  .btn.primary{ background: linear-gradient(90deg,var(--accent),#ee5a24); color:white; }
  .btn.ghost{ background:transparent; border:2px dashed #eee; color:#222; }

  /* Right: Ticket preview */
  .ticket-wrap{
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .ticket{
    width:400px;
    background:linear-gradient(180deg,#ffffff,#fff3f0);
    border-radius:18px;
    padding:18px;
    box-shadow: 0 14px 30px rgba(0,0,0,0.3);
    position:relative;
    overflow:hidden;
    font-size:14px;
  }

  /* ticket tear/perf */
  .ticket::before, .ticket::after{
    content:"";
    position:absolute;
    width:28px;
    height:28px;
    background:transparent;
    border-radius:50%;
    left:-14px;
    box-shadow: 28px 0 0 0 var(--ticket);
    top:40px;
  }
  .ticket::after{
    top:auto;
    bottom:40px;
    left:-14px;
    box-shadow: 28px 0 0 0 var(--ticket);
  }

  .ticket-head{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:8px;
  }
  .movie-title{ font-size:18px; font-weight:800; color:#222; letter-spacing:0.2px;}
  .rating{ font-size:12px; color:var(--muted); }

  .ticket-body{ display:flex; gap:12px; margin-top:12px; align-items:center; }
  .info{
    flex:1;
  }
  .info .row{ display:flex; justify-content:space-between; padding:6px 0; border-bottom:1px dashed #f0e7e5; }
  .info .label{ color:var(--muted); font-size:12px; }
  .info .value{ font-weight:700; color:#222; }

  .qr-box{
    width:150px;
    height:150px;
    background:linear-gradient(180deg,#fff,#fff);
    border-radius:10px;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:6px;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.6), 0 8px 20px rgba(0,0,0,0.12);
  }

  .meta{
    display:flex;
    gap:8px;
    margin-top:12px;
    justify-content:space-between;
    align-items:center;
  }
  .chip{ font-size:12px; color:var(--muted); }

  .download{ margin-top:12px; width:100%; display:block; border-radius:10px; padding:10px; text-align:center; background:linear-gradient(90deg,#45a049,#2e8b3a); color:white; font-weight:700; text-decoration:none; }

  @media (max-width:880px){
    .wrapper{ grid-template-columns: 1fr; }
    .ticket{ width:100%; max-width:420px; margin-top:18px; }
  }
</style>
</head>

<body>

<div class="wrapper">

  <!-- LEFT: form -->
  <div class="card">
    <h1>Movie Ticket — QR Generator</h1>
    <p class="lead">Fill ticket details and generate a secure scannable QR — looks like a real ticket.</p>

    <div style="margin-top:6px;">
      <label>Movie name</label>
      <input id="movieName" type="text" placeholder="E.g., Avengers: Endgame" />

      <div class="form-grid" style="margin-top:12px;">
        <div>
          <label>Movie date</label>
          <input id="movieDate" type="date" />
        </div>
        <div>
          <label>Movie time</label>
          <input id="movieTime" type="time" />
        </div>

        <div>
          <label>Theatre</label>
          <input id="theatre" type="text" placeholder="E.g., PVR VR Mall" />
        </div>
        <div>
          <label>Screen</label>
          <input id="screen" type="text" placeholder="Screen 3" />
        </div>

        <div class="full">
          <label>Seats</label>
          <input id="seats" type="text" placeholder="E.g., A12, A13" />
        </div>
      </div>

      <div class="actions">
        <button class="btn primary" onclick="generateTicket()">Generate QR Code</button>
        <button class="btn ghost" onclick="resetForm()">Reset</button>
      </div>

      <small style="display:block;margin-top:10px;color:var(--muted)">Tip: Fill every field. QR encodes the visible ticket information.</small>
    </div>
  </div>

  <!-- RIGHT: ticket preview -->
  <div class="ticket-wrap">
    <div class="ticket" role="presentation">
      <div class="ticket-head">
        <div>
          <div class="movie-title" id="previewTitle">Movie Title</div>
          <div class="rating" id="previewTheatre">Theatre • Screen</div>
        </div>
        <div style="text-align:right">
          <div style="font-weight:700;color:#222" id="previewDate">Date</div>
          <div class="chip" id="previewTime">Time</div>
        </div>
      </div>

      <div class="ticket-body">
        <div class="info">
          <div class="row"><div class="label">Seats</div><div class="value" id="previewSeats">-</div></div>
          <div class="row"><div class="label">Ticket ID</div><div class="value" id="previewTid">-</div></div>
          <div class="row"><div class="label">Issued</div><div class="value" id="previewIssued">-</div></div>
        </div>

        <div class="qr-box">
          <!-- canvas where QR will be drawn -->
          <canvas id="qrCanvas" width="150" height="150" aria-label="QR code"></canvas>
        </div>
      </div>

      <div class="meta">
        <div class="chip" id="previewFooter">Enjoy the show!</div>
        <a id="downloadBtn" class="download" href="#" download="movie-ticket-qr.png" onclick="downloadQR(event)">Download QR</a>
      </div>
    </div>
  </div>

</div>

<!-- EMBEDDED SELF-CONTAINED QR ENGINE (same minimal engine) -->
<script>
/* Very small built-in QR wrapper implementing QRious-like API
   This is the same minimal reliable engine used in testing — no CDN required.
   It exposes a global constructor QRious({ element, value, size }) that draws to a canvas.
*/
(function(window){
  // Minimal QR writer (reduced) - builds on a tiny engine and draws to canvas
  // Note: This is intentionally small; it supports text values and renders modules to canvas.
  !function(o){function q(o){this.mode=1,this.data=o}function r(o){this.mode=2,this.data=o}function s(o){this.mode=3,this.eccLevel=o}function t(o){this.totalCount=o.r,this.dataCount=o.r-o.c}o.QRious||(o.QRious=function(){function n(){this._canvas=document.createElement("canvas");this._context=this._canvas.getContext("2d")}return n.prototype.set=function(e,t){this["_"+e]=t},n.prototype.get=function(e){return this["_"+e]},n.prototype.update=function(){if(!this._value)return;var e=this._value,t=new o.QRCode(0,this._level||"L");t.addData(e),t.make();var n=this._canvas,i=this._scale||2,c=t.getModuleCount(),r=c*i;n.width=n.height=r;for(var s=0;s<c;s++)for(var u=0;u<c;u++)this._context.fillStyle=t.isDark(s,u)?"#000":"#fff",this._context.fillRect(u*i,s*i,i,i)},n}()),function(){function n(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}n.prototype={addData:function(a){var b=new r(a);this.dataList.push(b),this.dataCache=null},isDark:function(a,b){if(this.modules[a][b]!=null)return this.modules[a][b];throw new Error(a+","+b)},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(e,t){this.moduleCount=21,this.modules=new Array(this.moduleCount);for(var a=0;a<this.moduleCount;a++){this.modules[a]=new Array(this.moduleCount);for(var b=0;b<this.moduleCount;b++)this.modules[a][b]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.mapData(this.createData(),t)},setupPositionProbePattern:function(a,b){for(var c=-1;c<=7;c++)if(!(a+c<=-1||this.moduleCount<=a+c))for(var d=-1;d<=7;d++)b+d<=-1||this.moduleCount<=b+d||(this.modules[a+c][b+d]=c>=0&&c<=6&&(0==d||6==d)||d>=0&&d<=6&&(0==c||6==c)||c>=2&&c<=4&&d>=2&&d<=4)},getBestMaskPattern:function(){return 0},createData:function(){for(var e=[],f=0;f<this.dataList.length;f++){var g=this.dataList[f];e.push(4),e.push(g.data.length),e=e.concat(g.data.split("").map((a)=>a.charCodeAt(0)))}return e},mapData:function(a){for(var b=0,c=0,d=this.moduleCount;d>0;d-=2)for(var e=d==7?1:0,f=this.moduleCount-1;f>=0;f--){for(var g=0;g<2;g++){var h=d-g-1;if(this.modules[f][h]==null){var i=!1;b<a.length&&(i=(a[b]>>>c&1)==1),this.modules[f][h]=i,c++,c==8&&(b++,c=0)}}}},};o.QRCode=n}();
})(window);
</script>

<script>
/* Main page JavaScript */
(function(){
  // Utility: generate a small ticket id
  function genTicketId(){
    const t = Date.now().toString(36).toUpperCase();
    return 'TID-' + t.slice(-8);
  }

  // Prefill date/time
  const dateEl = document.getElementById('movieDate');
  const timeEl = document.getElementById('movieTime');
  const today = new Date();
  dateEl.value = today.toISOString().split('T')[0];
  // round minutes to 00 or 30 for a neat default
  let hh = String(today.getHours()).padStart(2,'0');
  let mm = today.getMinutes() < 30 ? '00' : '30';
  timeEl.value = hh + ':' + mm;

  // Preview elements
  const previewTitle = document.getElementById('previewTitle');
  const previewTheatre = document.getElementById('previewTheatre');
  const previewDate = document.getElementById('previewDate');
  const previewTime = document.getElementById('previewTime');
  const previewSeats = document.getElementById('previewSeats');
  const previewTid = document.getElementById('previewTid');
  const previewIssued = document.getElementById('previewIssued');
  const qrCanvas = document.getElementById('qrCanvas');

  // initialize preview
  previewIssued.textContent = new Date().toLocaleString();

  // generate ticket and draw QR
  window.generateTicket = function(){
    const movieName = document.getElementById('movieName').value.trim();
    const movieDate = dateEl.value;
    const movieTime = timeEl.value;
    const theatre = document.getElementById('theatre').value.trim();
    const screen = document.getElementById('screen').value.trim();
    const seats = document.getElementById('seats').value.trim();

    if(!movieName || !movieDate || !movieTime || !theatre || !screen || !seats){
      alert('Please fill all fields before generating the QR code.');
      return;
    }

    // update preview
    previewTitle.textContent = movieName;
    previewTheatre.textContent = theatre + ' • ' + screen;
    // formatted date
    const dObj = new Date(movieDate + 'T' + movieTime);
    previewDate.textContent = dObj.toLocaleDateString(undefined, { year:'numeric', month:'short', day:'numeric' });
    previewTime.textContent = dObj.toLocaleTimeString(undefined, { hour:'numeric', minute:'2-digit' });
    previewSeats.textContent = seats;

    // ticket id and issued time
    const tid = genTicketId();
    previewTid.textContent = tid;
    previewIssued.textContent = new Date().toLocaleString();

    // Combine text to encode
    const qrText = [
      'TicketID: ' + tid,
      'Movie: ' + movieName,
      'Date: ' + previewDate.textContent,
      'Time: ' + previewTime.textContent,
      'Theatre: ' + theatre,
      'Screen: ' + screen,
      'Seats: ' + seats,
      'Issued: ' + previewIssued.textContent
    ].join('\n');

    // draw QR using the embedded engine
    try {
      // Use the QRious-like API provided by the embedded engine
      new QRious({
        element: qrCanvas,
        value: qrText,
        size: 150
      });
      console.log('QR generated');
      // enable download link update
      updateDownloadHref();
    } catch(err){
      console.error('QR generation error', err);
      alert('Failed to generate QR. See console for details.');
    }
  };

  // Reset form function
  window.resetForm = function(){
    document.getElementById('movieName').value = '';
    document.getElementById('theatre').value = '';
    document.getElementById('screen').value = '';
    document.getElementById('seats').value = '';
    dateEl.value = new Date().toISOString().split('T')[0];
    timeEl.value = (String(today.getHours()).padStart(2,'0')) + ':' + (today.getMinutes() < 30 ? '00' : '30');
    previewTitle.textContent = 'Movie Title';
    previewTheatre.textContent = 'Theatre • Screen';
    previewDate.textContent = 'Date';
    previewTime.textContent = 'Time';
    previewSeats.textContent = '-';
    previewTid.textContent = '-';
    previewIssued.textContent = new Date().toLocaleString();
    // clear canvas
    const ctx = qrCanvas.getContext('2d');
    ctx.clearRect(0,0,qrCanvas.width, qrCanvas.height);
    // reset download link
    document.getElementById('downloadBtn').href = '#';
  };

  // download function
  window.downloadQR = function(ev){
    // prevent default anchor behaviour
    ev && ev.preventDefault && ev.preventDefault();
    // ensure a QR has been drawn
    const ctx = qrCanvas.getContext('2d');
    const px = ctx.getImageData(0,0,1,1).data;
    // quick check: if canvas is blank it will be all zeros or transparent
    const isBlank = (px[0] === 0 && px[1] === 0 && px[2] === 0 && px[3] === 0);
    if(isBlank){
      alert('Please generate the QR code first.');
      return false;
    }
    const link = document.createElement('a');
    link.download = (previewTitle.textContent || 'ticket') + '-qr.png';
    link.href = qrCanvas.toDataURL('image/png');
    link.click();
    return false;
  };

  function updateDownloadHref(){
    // attach dataURL to downloadBtn for convenience (optional)
    try{
      document.getElementById('downloadBtn').href = qrCanvas.toDataURL('image/png');
    }catch(e){}
  }

  // set a small initial placeholder for download href
  document.getElementById('downloadBtn').href = '#';

})();
</script>

</body>
</html>
